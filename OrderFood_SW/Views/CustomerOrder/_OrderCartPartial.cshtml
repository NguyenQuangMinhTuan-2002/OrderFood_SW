@using OrderFood_SW.ViewModels
@model List<OrderCartItem>
@{
    int currentTableId = Context.Session.GetInt32("CurrentTableId") ?? 0;
    decimal totalAmount = Model?.Sum(x => x.Price * x.Quantity) ?? 0;
}

<div class="order-panel" id="orderPanel" data-cart-container>
    <div class="table-info">
        <div>
            <div class="table-number">Current table number: @currentTableId</div>
            <div style="font-size: 12px; color: #64748b;">#</div>
        </div>
        <button class="action-btn">
            <i class="fas fa-edit"></i>
        </button>
    </div>
    <div class="order-panel-handle" id="orderPanelHandle"></div>
    <div class="order-items">
        @if (Model == null || Model.Count == 0)
        {
            <div class="empty-cart">
                <H3 class="#">Your cart is empty</H3>
                <br />
                <p>Add something to see more detail</p>
            </div>
        }
        else
        {
            @foreach (var item in Model)
            {
                <div class="order-item" data-item-id="@item.DishId">
                    <img src="~/images/@item.ImageUrl" alt="@item.DishName" class="order-item-image">
                    <div class="order-item-info">
                        <div class="order-item-name">
                            @item.DishName
                            <button class="remove-cart-item"
                                    style="width:21px; height: 22px; margin-left: 10px;"
                                    data-dish-id="@item.DishId"

                                    title="Remove item">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                        <div class="order-item-price">$@item.Price <i class="fa fa-arrow-right"></i> $@(item.Price* item.Quantity)</div>
                        <div class="order-item-qty">
                            <span>Amount: </span>
                            <div class="cart-quantity-controls" style="display: inline-flex; align-items: center; gap: 8px;">
                                <span class="quantity-display" style="min-width: 20px; text-align: center;">@item.Quantity</span>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
    <div class="order-total">
        <div class="total-row total-amount">
            <span>Total Amount</span>
            <span>$@totalAmount.ToString("F2")</span>
        </div>
    </div>
    <div class="cart-actions" style="margin-top: 15px;">
        @if (Model == null || Model.Count == 0)
        {
            <button class="btn btn-secondary" style="width: 100%; height: 50px; margin-bottom: 10px; border-radius:10px">Place Order</button>
            <button class="btn btn-secondary"
                    style="width: 100%; height: 50px; color: black; border: none; padding: 8px; border-radius: 10px;">
                Clear Cart
            </button>
        }
        else
        {
            <form method="post" asp-controller="CustomerOrder" asp-action="CustomerOrderInit">
                <input type="hidden" name="tableId" value="@currentTableId" />
                @* <input type="hidden" name="userId" value="@ViewBag.UserId" /> *@
                <button type="submit" class="place-order-btn" style="width: 100%; margin-bottom: 10px;">
                    <i class="fa fa-check-circle"></i> Confirm & Create Order
                </button>
            </form>
            @* <button class="place-order-btn" style="width: 100%; margin-bottom: 10px;">
                Place Order
            </button> *@
            <button class="clear-cart-btn"
            style="width: 100%; height: 50px ; color: white; background: #dc3545; border: none; padding: 8px; border-radius: 10px;">
                Clear Cart
            </button>
        }
    </div>
</div>
